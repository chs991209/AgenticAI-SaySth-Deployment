version: '3.8'

services:
  agentic-ai-server:
    build:
      context: .
      dockerfile: Dockerfile.agentic-ai
    container_name: agentic-ai-server-dev
    # [중요] Host 모드에서는 ports 설정 불필요 (자동으로 8002 열림)
    network_mode: "host"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - YOUTUBE_API_KEY=${YOUTUBE_API_KEY}
      # Host 모드이므로 그냥 localhost로 통신 가능
      - FRONTEND_SERVER_URL=http://localhost:3000
    volumes:
      - .:/app
      - /app/__pycache__
      - /app/agenticai-saysth-archive
    restart: unless-stopped
    command: uvicorn main:app --host 0.0.0.0 --port 8002 --reload

  frontend-server:
    build:
      context: ./frontend-server
      dockerfile: Dockerfile
    container_name: frontend-server-dev
    # [중요] Host 모드 사용
    network_mode: "host"
    environment:
      # 서로 localhost로 통신
      - AGENTIC_AI_SERVER_URL=http://localhost:8002
      - STT_SERVER_URL=http://localhost:8003
      - FRONTEND_SERVER_URL=http://localhost:3000
      - NODE_ENV=development
    volumes:
      - ./frontend-server:/app
      - /app/node_modules
      - /app/.next
    restart: unless-stopped
    command: npm run dev -- -p 3000 -H 0.0.0.0

# networks 섹션은 이제 필요 없음 (삭제)